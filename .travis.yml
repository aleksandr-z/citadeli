language: node_js
node_js:
  - 12
branches:
  only:
    - master
addons:
  ssh_known_hosts:
  - $IP
before_install:
  - openssl enc -aes-256-cbc -d -in ./.travis/deploy.enc -out ./.travis/deploy -k $KEY
  - eval "$(ssh-agent -s)"
  - cp ./.travis/deploy ~/.ssh/deploy
  - chmod 600 ~/.ssh/deploy
  - ssh-add ~/.ssh/deploy
install:
  - echo $PUB >> $HOME/.ssh/known_hosts
  - ls -al ./dist
  - tar -cvf archive.tar.gz ./dist/
  - ls -al ./dist
  - ls -al ./
  - chmod 600 ./archive.tar.gz

deploy:
  - provider: script
    skip_cleanup: true
    script: bash .travis/deploy.sh
    on:
      branch: master

#after_deploy:
#  - chmod +x ./.travis/after_deploy.sh
#  - ./.travis/after_deploy.sh
